# Deployment Guide - AI Debate Platform

## Overview
This guide covers deploying both dev and prod environments to the cloud:
- **Frontend**: Next.js on Vercel
- **Backend**: FastAPI on Railway
- **Database**: PostgreSQL on Railway

## Environment Setup

### Development Environment
- **Frontend**: `your-app-dev.vercel.app`
- **Backend**: `your-backend-dev.up.railway.app`
- **Database**: Development PostgreSQL instance

### Production Environment
- **Frontend**: `your-app.vercel.app` (custom domain optional)
- **Backend**: `your-backend-prod.up.railway.app`
- **Database**: Production PostgreSQL instance

---

## Step 1: Railway Backend Setup

### 1.1 Create Railway Account
1. Go to [railway.app](https://railway.app)
2. Sign up with GitHub account
3. Connect your repository

### 1.2 Deploy Backend (Development)
```bash
# In your backend directory
railway login
railway init
railway add --database postgresql
railway deploy
```

### 1.3 Configure Environment Variables
In Railway dashboard, add these variables:
```
DATABASE_URL=<auto-generated by Railway>
OPENAI_API_KEY=<your-key>
ANTHROPIC_API_KEY=<your-key>
PORT=8000
RAILWAY_ENVIRONMENT=development
CORS_ORIGINS=https://your-app-dev.vercel.app
```

### 1.4 Deploy Backend (Production)
1. Create new Railway project for production
2. Connect same repository
3. Set environment to production
4. Update CORS_ORIGINS to production domain

---

## Step 2: Vercel Frontend Setup

### 2.1 Create Vercel Account
1. Go to [vercel.com](https://vercel.com)
2. Sign up with GitHub account
3. Import your repository

### 2.2 Configure Environment Variables
In Vercel dashboard, add these variables:

**Development Environment:**
```
NEXT_PUBLIC_BACKEND_URL=https://your-backend-dev.up.railway.app
NEXT_PUBLIC_ENV=development
```

**Production Environment:**
```
NEXT_PUBLIC_BACKEND_URL=https://your-backend-prod.up.railway.app
NEXT_PUBLIC_ENV=production
```

### 2.3 Update vercel.json
Update the backend URL in `vercel.json` with your actual Railway URL.

---

## Step 3: Database Setup

### 3.1 Railway PostgreSQL
Railway automatically provides PostgreSQL. Access via:
```bash
railway connect postgresql
```

### 3.2 Database Migrations
```python
# Add to your FastAPI app
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
import os

DATABASE_URL = os.getenv("DATABASE_URL")
engine = create_engine(DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
```

---

## Step 4: Deployment Commands

### Deploy Development
```bash
# Backend
cd backend
railway deploy

# Frontend
cd ..
vercel --prod=false
```

### Deploy Production
```bash
# Backend
cd backend
railway deploy --environment production

# Frontend
cd ..
vercel --prod
```

---

## Step 5: Monitoring & Maintenance

### Health Checks
- **Backend**: `https://your-backend.up.railway.app/health`
- **Frontend**: Vercel provides automatic monitoring

### Logs
```bash
# Railway logs
railway logs

# Vercel logs
vercel logs
```

### Cost Monitoring
- **Railway**: $5/month per service (dev + prod)
- **Vercel**: Free tier sufficient for development, Pro at $20/month for production

---

## Troubleshooting

### Common Issues
1. **CORS Errors**: Update CORS_ORIGINS in Railway
2. **Environment Variables**: Check Vercel and Railway dashboards
3. **Database Connection**: Verify DATABASE_URL format
4. **API Routes**: Ensure vercel.json rewrites are correct

### Debug Commands
```bash
# Check Railway status
railway status

# Test backend health
curl https://your-backend.up.railway.app/health

# Check Vercel deployment
vercel inspect
```

---

## Security Checklist

- [ ] All API keys stored as environment variables
- [ ] CORS properly configured
- [ ] Database credentials secured
- [ ] HTTPS enforced on production
- [ ] Rate limiting implemented
- [ ] Authentication tokens secured

---

## Next Steps

1. Set up CI/CD with GitHub Actions
2. Add monitoring with Railway + Vercel analytics
3. Configure custom domains
4. Set up backup strategies
5. Implement logging and error tracking 